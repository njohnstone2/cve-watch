# Publish repo
KO_DOCKER_REPO ?= "ghcr.io/njohnstone2"
KO_TAGS ?= "latest"

TEST_SUITE ?= "..."

test:
	go test -v ./$(TEST_SUITE)

vulncheck:
	@govulncheck ./...

build:
	$(eval BUILD_IMG=$(shell KO_DOCKER_REPO="$(KO_DOCKER_REPO)" ko build -B github.com/njohnstone2/cve-watch/cmd/cve-watch))
	$(eval IMG_REPOSITORY=$(shell echo $(BUILD_IMG) | cut -d "@" -f 1 | cut -d ":" -f 1))
	$(eval IMG_TAG=$(shell echo $(BUILD_IMG) | cut -d "@" -f 1 | cut -d ":" -f 2 -s))
	$(eval IMG_DIGEST=$(shell echo $(BUILD_IMG) | cut -d "@" -f 2))

.PHONY: build test vulncheck
